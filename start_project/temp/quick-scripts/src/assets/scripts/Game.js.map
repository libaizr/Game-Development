{"version":3,"sources":["assets\\scripts\\Game.js"],"names":["cc","Class","Component","properties","starPrefab","type","Prefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","onLoad","groundY","y","height","timer","starDuration","spawnNewStar","score","update","dt","gameOver","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","getComponent","game","Math","random","randX","randY","jumpHeight","maxX","width","v2","start","gainScore","string","audioEngine","playEffect","stopAllActions","director","loadScene"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    //引用星星的预制资源\r\n    starPrefab: {\r\n      default: null,\r\n      type: cc.Prefab\r\n    },\r\n\r\n    //星星产生后消失时间的随机范围\r\n    maxStarDuration: 0,\r\n    minStarDuration: 0,\r\n\r\n    //地面节点，用于确定星星产生的高度\r\n    ground: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n\r\n    //Player节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n    player: {\r\n      default: null,\r\n      type: cc.Node\r\n    },\r\n\r\n    //Score引用\r\n    scoreDisplay: {\r\n      default: null,\r\n      type: cc.Label\r\n    },\r\n\r\n    //引用得分音频文件\r\n    scoreAudio: {\r\n      default: null,\r\n      type: cc.AudioClip,\r\n    }\r\n  },\r\n\r\n  // LIFE-CYCLE CALLBACKS:\r\n\r\n  onLoad: function () {\r\n    //获取地平面的y坐标\r\n    this.groundY = this.ground.y + this.ground.height / 2;\r\n\r\n    //初始化计时器\r\n    this.timer = 0;\r\n    this.starDuration = 0;\r\n\r\n    //生成一个新的星星\r\n    this.spawnNewStar();\r\n\r\n    //初始化记分\r\n    this.score = 0;\r\n\r\n  },\r\n\r\n  update: function (dt) {\r\n    //每帧刷新定时器，超过限度还没生成新的星星，调用失败逻辑\r\n    if (this.timer > this.starDuration) {\r\n      this.gameOver();\r\n      return;\r\n    }\r\n\r\n    this.timer += dt;\r\n  },\r\n\r\n  spawnNewStar: function () {\r\n    //使用给定的模板在场景中生成一个新节点\r\n    var newStar = cc.instantiate(this.starPrefab);\r\n    //将生成的节点添加到Canvas节点下面\r\n    this.node.addChild(newStar);\r\n    //为星星随机设置一个位置\r\n    newStar.setPosition(this.getNewStarPosition());\r\n\r\n    //在星星脚本组件上保存Game对象的引用\r\n    newStar.getComponent('Star').game = this;\r\n\r\n    //重置计时器，根据小时时间范围随机取一个值\r\n    this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n    this.timer = 0;\r\n  },\r\n\r\n  getNewStarPosition: function () {\r\n    var randX = 0;\r\n    //根据地平面位置和主角跳跃高度，随机得到一个星星的y坐标\r\n    var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 20;\r\n    //根据屏幕宽度，随机得到一个星星的x坐标\r\n    var maxX = this.node.width / 2;\r\n    randX = (Math.random() - 0.5) * 2 * maxX;\r\n    //返回星星的坐标\r\n    return cc.v2(randX, randY);\r\n  },\r\n\r\n  start() {\r\n\r\n  },\r\n\r\n  gainScore() {\r\n    this.score += 1;\r\n    // 更新scoreDisplay Label的文字\r\n    this.scoreDisplay.string = 'Score: ' + this.score;\r\n\r\n    //得分音效\r\n    cc.audioEngine.playEffect(this.scoreAudio, false);\r\n  },\r\n\r\n  gameOver() {\r\n    //停止player的跳跃动作\r\n    this.player.stopAllActions();\r\n\r\n    //重新加载场景game\r\n    cc.director.loadScene('game');\r\n  }\r\n});\r\n"]}